<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏£‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - EasyMeal</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">EasyMeal</div>
    <div class="top-actions">
      <span id="pointLabel" class="point-label hidden"></span>
      <span id="userLabel" class="user-label hidden"></span>
      
      <button class="btn small" onclick="location.href='index.html'">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
  </header>

  <main class="wide-container" style="text-align:center">
    <h2>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
    
    <div class="queueCard">
  <p>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠</p>
  
  <h1 id="queueNumber">A001</h1>

  <p id="waitText" style="font-size: 1.2rem;">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <span style="color:#B33939; font-weight:bold;">1</span> ‡∏Ñ‡∏¥‡∏ß</p>

  <p id="queueStatus" style="color:#e67e22; font-weight:bold;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£...</p>
</div>

    <div style="margin-top: 20px; text-align: left; background: #fafafa; padding: 15px; border-radius: 10px; border: 1px solid #eee;">
      <h3 style="border-bottom: 1px solid #ddd; padding-bottom: 8px;">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
      
      <div id="receiptList"></div>
      
      <div style="margin-top:10px; border-top: 1px dashed #bbb; padding-top: 10px; display:flex; justify-content:space-between; font-weight:bold; font-size: 1.1em;">
        <span>‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
        <span><span id="receiptTotal">0</span> ‡∏ö‡∏≤‡∏ó</span>
      </div>
    </div>

    <div style="margin-top:20px">
      <button class="btn" onclick="location.href='index.html'">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
  </main>

<script>
/* ----------------------------------------------------
   1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤
---------------------------------------------------- */
const menus = {
  somtum: {
    '‡∏ï‡∏≥‡πÑ‡∏ó‡∏¢': { price: 50 }, 
    '‡∏ï‡∏≥‡∏õ‡∏π‡∏õ‡∏•‡∏≤‡∏£‡πâ‡∏≤': { price: 60 }, 
    '‡∏Ñ‡∏≠‡∏´‡∏°‡∏π‡∏¢‡πà‡∏≤‡∏á': { price: 70 }, 
    '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß': { price: 10 }
  },
  tamsang: {
    '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö': { price: 55 }, 
    '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö': { price: 50 }, 
    '‡∏ú‡∏±‡∏î‡∏ã‡∏µ‡∏≠‡∏¥‡πä‡∏ß‡∏´‡∏°‡∏π': { price: 55 }, 
    '‡∏ú‡∏±‡∏î‡∏°‡∏≤‡∏°‡πà‡∏≤': { price: 50 }, 
    '‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß': { price: 10 }
  },
  noodle: {
    '‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏ô‡πâ‡∏≥‡∏´‡∏°‡∏π‡πÅ‡∏î‡∏á': { price: 50 }, 
    '‡πÄ‡∏¢‡πá‡∏ô‡∏ï‡∏≤‡πÇ‡∏ü': { price: 60 }, 
    '‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏£‡∏∑‡∏≠': { price: 55 }, 
    '‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤': { price: 60 }
  },
  friedchicken: {
    '‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î 2 ‡∏ä‡∏¥‡πâ‡∏ô': { price: 40 }, 
    '‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡πá‡∏ï‡πÑ‡∏Å‡πà': { price: 55 }, 
    '‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î': { price: 25 },
    '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß': { price: 10 }
  },
  dessert: {
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡∏ô‡∏°‡∏™‡∏î': { price: 70 }, 
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡πÇ‡∏≠‡∏ß‡∏±‡∏•‡∏ï‡∏¥‡∏ô': { price: 70 }, 
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡∏°‡∏±‡∏à‡∏â‡∏∞': { price: 70 },
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡∏™‡∏ï‡∏£‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà': { price: 70 }
  }
};

/* ----------------------------------------------------
   2. ‡πÅ‡∏™‡∏î‡∏á User
---------------------------------------------------- */
/* ----------------------------------------------------
   2. ‡πÅ‡∏™‡∏î‡∏á User
---------------------------------------------------- */
const user = localStorage.getItem('user');
const userLabel = document.getElementById('userLabel');
const pointLabel = document.getElementById('pointLabel'); // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°

if(user){
  userLabel.innerText = "User: " + user;
  userLabel.classList.remove('hidden');

  // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô
  let currentPoints = parseFloat(localStorage.getItem('userPoints') || '0');
  pointLabel.innerText = "‡πÄ‡∏á‡∏¥‡∏ô: " + currentPoints.toLocaleString() + " ‡∏ö.";
  pointLabel.classList.remove('hidden');
}

/* ----------------------------------------------------
   3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏¥‡∏ß (Queue System) - ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 1
---------------------------------------------------- */
const finishedOrder = JSON.parse(localStorage.getItem('finishedOrder') || 'null');
let myQueue = "";

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏¥‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏ì‡∏µ User ‡∏Å‡∏î Refresh ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠)
if(finishedOrder && finishedOrder.queueNo) {
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡∏¥‡∏°
    myQueue = finishedOrder.queueNo;
} else {
    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ (‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà) ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡πÄ‡∏•‡∏Ç‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 0
    let currentQ = parseInt(localStorage.getItem('systemQueueRunning') || '0');
    
    // ‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° 1 (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 1, 2, 3...)
    currentQ++;
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
    localStorage.setItem('systemQueueRunning', currentQ);
    
    // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö A001, A002
    myQueue = "A" + String(currentQ).padStart(3, '0');
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏¥‡∏ß‡∏•‡∏á‡πÉ‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏•‡∏Ç‡πÑ‡∏ß‡πâ ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä)
    if(finishedOrder) {
        finishedOrder.queueNo = myQueue;
        localStorage.setItem('finishedOrder', JSON.stringify(finishedOrder));
    }
}

document.getElementById('queueNumber').innerText = myQueue;

const receiptList = document.getElementById('receiptList');
const receiptTotal = document.getElementById('receiptTotal');

if(finishedOrder && finishedOrder.cart) {
  let html = '<ul style="padding-left: 20px; list-style: none; margin: 0;">';
  let totalMoney = 0;
  
  const shopName = finishedOrder.shop; 

finishedOrder.cart.forEach(item => {
    const menuInfo = menus[shopName]?.[item.menuName];
    
    if(menuInfo) {
        let pricePerItem = menuInfo.price;
        if(item.special) pricePerItem += 10;
        
        let sumPrice = pricePerItem * item.qty;
        totalMoney += sumPrice;

        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        let optText = item.takeAway ? "üì¶ ‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á" : "üçΩÔ∏è ‡πÉ‡∏™‡πà‡∏à‡∏≤‡∏ô";

        html += `
          <li style="display:flex; justify-content:space-between; margin-bottom:6px; border-bottom:1px solid #f0f0f0; padding-bottom:4px;">
            <div>
                ${item.menuName} ${item.special ? '(‡∏û‡∏¥‡πÄ‡∏®‡∏©)' : ''} <br>
                <span style="font-size:0.85em; color:#777;">${optText}</span>
                <span style="color:#888; font-size:0.9em;">x${item.qty}</span>
            </div>
            <span>${sumPrice} ‡∏ö.</span>
          </li>
        `;
    }
  });
  html += '</ul>';
  
  if(finishedOrder.note) {
    html += `<p style="color:red; font-size:0.9em; margin-top:8px;">*‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${finishedOrder.note}</p>`;
  }
  
  // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö
  let eatType = "";
  if(finishedOrder.eatHere) eatType = "‡πÉ‡∏™‡πà‡∏à‡∏≤‡∏ô";
  if(finishedOrder.takeAway) eatType = "‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á";
  if(eatType) {
      html += `<p style="font-size:0.9em; color:#555; margin-top:5px;">‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${eatType}</p>`;
  }

  receiptList.innerHTML = html;
  receiptTotal.innerText = totalMoney.toLocaleString();
  
} else {
  receiptList.innerHTML = '<p style="text-align:center; color:#999;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>';
}

document.getElementById('queueNumber').innerText = "A001";

// 2. ‡∏™‡∏±‡πà‡∏á‡∏£‡∏≠ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
setTimeout(() => {
  // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å 1 ‡∏Ñ‡∏¥‡∏ß"
  document.getElementById('waitText').style.display = 'none';

  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
  const status = document.getElementById('queueStatus');
  status.innerText = '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡πÄ‡∏ä‡∏¥‡∏ç‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏≤‡∏ô‡πå‡πÄ‡∏ï‡∏≠‡∏£‡πå';
  status.style.color = 'green';
  
  // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  new Audio('sound.mp3').play().catch(e=>console.error(e));
  volume: 10;
}, 10000); // 10000 ms = 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

</script>
</body>
</html>