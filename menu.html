<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡πÄ‡∏°‡∏ô‡∏π - EasyMeal</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">EasyMeal</div>
    <div class="top-actions">
      <span id="pointLabel" class="point-label hidden"></span>
      <span id="userLabel" class="user-label hidden"></span>
      
      <button id="loginBtn" class="btn small hidden" onclick="location.href='login.html'">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <button id="logoutBtn" class="btn small hidden" onclick="doLogout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      <button class="btn small" onclick="location.href='index.html'">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
  </header>

  <main class="container" style="margin-top: 40px;">
    <h2 id="shopTitle">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>

    <div class="menuLayout">
      <div class="menuColumn" id="menuList"></div>

      <aside class="summaryColumn">
        <div class="summaryCard">
          <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
          <div id="orderSummary"><i>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</i></div>

          <label for="noteArea">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
          <textarea id="noteArea" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ú‡∏±‡∏Å / ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß‡∏™‡∏∏‡∏Å
‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ"></textarea>
          
          <div class="summaryFooter">
            <div class="totalLine">‡∏£‡∏ß‡∏°: <span id="totalPrice">0</span> ‡∏ö‡∏≤‡∏ó</div>
            <div style="display:flex;gap:8px;margin-top:6px">
              <button class="btn" onclick="goToPayment()">‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
              <button class="btn ghost" onclick="clearCart()">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>

<script>
/* -------------------------------
      1. ‡∏£‡∏∞‡∏ö‡∏ö Login / Logout / Points
--------------------------------*/
let user = localStorage.getItem('user');
const userLabel = document.getElementById('userLabel');
const logoutBtn = document.getElementById('logoutBtn');
const loginBtn = document.getElementById('loginBtn'); 
const pointLabel = document.getElementById('pointLabel');

if(user){
    userLabel.innerText = "User: " + user;
    userLabel.classList.remove('hidden');
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô
    let currentPoints = parseFloat(localStorage.getItem('userPoints') || '0');
    pointLabel.innerText = "‡πÄ‡∏á‡∏¥‡∏ô: " + currentPoints.toLocaleString() + " ‡∏ö.";
    pointLabel.classList.remove('hidden');

    logoutBtn.classList.remove('hidden');
} 
else {
    loginBtn.classList.remove('hidden');
}

function doLogout(){
  localStorage.removeItem('user');
  alert('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  location.href = 'index.html';
}

/* -------------------------------
      2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Data)
--------------------------------*/
const urlParams = new URLSearchParams(window.location.search);
let shop = urlParams.get('shop') || 'somtum';

const shopNamesTH = {
  somtum: "‡∏£‡πâ‡∏≤‡∏ô‡∏™‡πâ‡∏°‡∏ï‡∏≥",
  tamsang: "‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á",
  noodle: "‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß",
  friedchicken: "‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î",
  dessert: "‡∏£‡πâ‡∏≤‡∏ô‡∏ö‡∏¥‡∏á‡∏ã‡∏π",
};

const menus = {
  somtum: {
    '‡∏ï‡∏≥‡πÑ‡∏ó‡∏¢': { price: 50, img: 'somtum/‡∏ï‡∏≥‡πÑ‡∏ó‡∏¢.jpg', canSpecial: true },
    '‡∏ï‡∏≥‡∏õ‡∏π‡∏õ‡∏•‡∏≤‡∏£‡πâ‡∏≤': { price: 60, img: 'somtum/‡∏ï‡∏≥‡∏õ‡∏π‡∏õ‡∏•‡∏≤‡∏£‡πâ‡∏≤.webp', canSpecial: true },
    '‡∏Ñ‡∏≠‡∏´‡∏°‡∏π‡∏¢‡πà‡∏≤‡∏á': { price: 70, img: 'somtum/‡∏Ñ‡∏≠‡∏´‡∏°‡∏π‡∏¢‡πà‡∏≤‡∏á.jpg', canSpecial: true },
    '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß': { price: 10, img: 'somtum/‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß.jpg', canSpecial: false }
  },
  tamsang: {
    '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö': { price: 55, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö.jpg', canSpecial: true },
    '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö': { price: 50, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö.webp', canSpecial: true },
    '‡∏ú‡∏±‡∏î‡∏ã‡∏µ‡∏≠‡∏¥‡πä‡∏ß‡∏´‡∏°‡∏π': { price: 55, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡∏ú‡∏±‡∏î‡∏ã‡∏µ‡∏≠‡∏¥‡πä‡∏ß.jpg', canSpecial: true },
    '‡∏ú‡∏±‡∏î‡∏°‡∏≤‡∏°‡πà‡∏≤': { price: 50, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡∏ú‡∏±‡∏î‡∏°‡∏≤‡∏°‡πà‡∏≤.jpg', canSpecial: true },
    '‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß': { price: 10, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß.webp', canSpecial: false }
  },
  noodle: {
    '‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏ô‡πâ‡∏≥‡∏´‡∏°‡∏π‡πÅ‡∏î‡∏á': { price: 50, img: 'noodle/‡∏ô‡πâ‡∏≥‡∏´‡∏°‡∏π‡πÅ‡∏î‡∏á.jpg', canSpecial: true },
    '‡πÄ‡∏¢‡πá‡∏ô‡∏ï‡∏≤‡πÇ‡∏ü': { price: 60, img: 'noodle/‡πÄ‡∏¢‡πá‡∏ô‡∏ï‡∏≤‡πÇ‡∏ü.jpg', canSpecial: true },
    '‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏£‡∏∑‡∏≠': { price: 55, img: 'noodle/‡πÄ‡∏ï‡πã‡∏ß‡πÄ‡∏£‡∏∑‡∏≠.jpg', canSpecial: true },
    '‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤': { price: 60, img: 'noodle/‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤.jpg', canSpecial: true }
  },
  friedchicken: {
    '‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î 2 ‡∏ä‡∏¥‡πâ‡∏ô': { price: 40, img: 'friedchicken/‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà.webp', canSpecial: false },
    '‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡πá‡∏ï‡πÑ‡∏Å‡πà': { price: 55, img: 'friedchicken/‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡πá‡∏ï.jpg', canSpecial: false },
    '‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î': { price: 25, img: 'friedchicken/‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà.webp', canSpecial: false },
    '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß': { price: 10, img: 'friedchicken/‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß.jpg', canSpecial: false }
  },
  dessert: {
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡∏ô‡∏°‡∏™‡∏î': { price: 70, img: 'dessert/‡∏ô‡∏°‡∏™‡∏î.jpg', canSpecial: false },
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡πÇ‡∏≠‡∏ß‡∏±‡∏•‡∏ï‡∏¥‡∏ô': { price: 70, img: 'dessert/‡πÇ‡∏≠‡∏ß‡∏±‡∏•‡∏ï‡∏¥‡∏ô.jpg', canSpecial: false },
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡∏°‡∏±‡∏à‡∏â‡∏∞': { price: 70, img: 'dessert/‡∏°‡∏±‡∏à‡∏â‡∏∞.jpg', canSpecial: false } ,
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡∏™‡∏ï‡∏£‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà': { price: 70, img: 'dessert/‡∏™‡∏ï‡∏£‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà.jpg', canSpecial: false }
  }
};

/* -------------------------------
      3. ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏°‡∏ô‡∏π (Render)
--------------------------------*/
let cart = JSON.parse(localStorage.getItem('cart') || '[]');
renderMenu();
renderSummary();

function renderMenu(){
  const list = document.getElementById('menuList');
  if(shopNamesTH[shop]) {
      document.getElementById('shopTitle').innerText = shopNamesTH[shop];
  }
  list.innerHTML = '';

  Object.entries(menus[shop]).forEach(([menuName, item], idx) => {
    const div = document.createElement('div');
    div.className = 'menuCard';
    div.innerHTML = `
      <div class="imgBox">
        <img src="img/${item.img}" class="menuImg" onerror="this.src='https://via.placeholder.com/100?text=No+Image'">
      </div>

      <div class="menuInfo">
        <div style="display:flex;justify-content:space-between;align-items:center; margin-bottom:10px;">
          <strong>${menuName}</strong>
          <span style="color:#666">${item.price} ‡∏ö‡∏≤‡∏ó</span>
        </div>

        <div style="margin-bottom: 12px; padding: 0 4px;">
            
            <label style="display: flex; justify-content: space-between; align-items: center; cursor: pointer; width: 100%; margin-bottom: 6px;">
                <span style="font-size: 0.95em; color:#333;">‡πÉ‡∏™‡πà‡∏à‡∏≤‡∏ô</span>
                <input type="radio" name="option-${idx}" value="here" checked style="width:18px; height:18px; cursor:pointer;">
            </label>

            <label style="display: flex; justify-content: space-between; align-items: center; cursor: pointer; width: 100%; margin: 0;">
                <span style="font-size: 0.95em; color:#333;">‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á</span>
                <input type="radio" name="option-${idx}" value="away" style="width:18px; height:18px; cursor:pointer;">
            </label>

        </div>

        <div class="qtyRow">
          <button class="smallBtn" onclick="decQty(${idx})">‚Äì</button>
          <div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <span id="qty-${idx}">1</span></div>
          <button class="smallBtn" onclick="incQty(${idx})">+</button>

          ${item.canSpecial ? `
            <label class="tick">
              <input type="checkbox" id="special-${idx}"> ‡∏û‡∏¥‡πÄ‡∏®‡∏© (+10 ‡∏ø)
            </label>
          ` : ``}

          <button class="btn small" onclick="addToCart('${menuName}')">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
      </div>
    `;

    list.appendChild(div);
  });
}

function incQty(idx){
  const qtyEl = document.getElementById(`qty-${idx}`);
  qtyEl.innerText = parseInt(qtyEl.innerText) + 1;
}

function decQty(idx){
  const qtyEl = document.getElementById(`qty-${idx}`);
  let q = parseInt(qtyEl.innerText);
  if(q > 1) qtyEl.innerText = q - 1;
}

/* -------------------------------
      4. ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Cart Logic)
--------------------------------*/
function addToCart(menuName){

  const user = localStorage.getItem('user');
  if(!user) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£');
    location.href = 'login.html';
    return;
  }

  let tempIndex = Object.keys(menus[shop]).indexOf(menuName); 

  const qtyEl = document.getElementById(`qty-${tempIndex}`);
  const qty = parseInt(qtyEl.innerText);
  const item = menus[shop][menuName];

  // 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å (‡∏û‡∏¥‡πÄ‡∏®‡∏©)
  const specialChecked = item.canSpecial
    ? document.getElementById(`special-${tempIndex}`).checked
    : false;

  // 2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡πÉ‡∏™‡πà‡∏à‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á
  const optionRadios = document.getElementsByName(`option-${tempIndex}`);
  let isTakeAway = false; // ‡∏Ñ‡πà‡∏≤ default ‡∏Ñ‡∏∑‡∏≠ false (‡πÉ‡∏™‡πà‡∏à‡∏≤‡∏ô)
  for(let radio of optionRadios){
      if(radio.checked && radio.value === 'away') {
          isTakeAway = true; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô true
      }
  }

  if(qty < 1){
    alert("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡∏¥‡πâ‡∏ô");
    return;
  }

  // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏Å‡∏≠‡∏á)
  const itemIndex = cart.findIndex(it => 
      it.menuName === menuName && 
      it.shop === shop && 
      it.special === specialChecked &&
      it.takeAway === isTakeAway 
  );

  if(itemIndex > -1){
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡πä‡∏∞ ‡πÉ‡∏´‡πâ‡∏ö‡∏ß‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°
    cart[itemIndex].qty += qty;
  } else {
    // ‡∏ñ‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏™‡πà‡∏à‡∏≤‡∏ô ‡∏≠‡∏µ‡∏Å‡∏≠‡∏±‡∏ô‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á) ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
    cart.push({
        menuName: menuName, 
        shop: shop, 
        qty: qty, 
        special: specialChecked,
        takeAway: isTakeAway
    });
  }

  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
  qtyEl.innerText = 1;
  if(item.canSpecial) document.getElementById(`special-${tempIndex}`).checked = false;
  // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Radio ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏™‡πà‡∏à‡∏≤‡∏ô‡πÄ‡∏™‡∏°‡∏≠
  if(optionRadios.length > 0) optionRadios[0].checked = true;

  saveAndRender();
}

function saveAndRender(){
  localStorage.setItem('cart', JSON.stringify(cart));
  renderSummary();
}

function renderSummary(){
  const summary = document.getElementById('orderSummary');
  const totalDisplay = document.getElementById('totalPrice');

  if(cart.length === 0){
    summary.innerHTML = '<i>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</i>';
    totalDisplay.innerText = '0';
    return;
  }

  let total = 0;
  let html = '';

  cart.forEach((it, index) => {
    const item = menus[it.shop][it.menuName]; 
    if(!item) return;

    const special = it.special ? 10 : 0;
    const sum = (item.price + special) * it.qty;
    total += sum;

    // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    const optionText = it.takeAway ? "üì¶ ‡πÉ‡∏™‡πà‡∏Å‡∏•‡πà‡∏≠‡∏á" : "üçΩÔ∏è ‡πÉ‡∏™‡πà‡∏à‡∏≤‡∏ô";

    html += `
      <div style="display:flex;justify-content:space-between; align-items:flex-start">
        <div>
            <span style="font-size:0.8em; color:#888">[${shopNamesTH[it.shop]}]</span><br>
            <strong>${it.menuName}</strong> ${it.special ? '(‡∏û‡∏¥‡πÄ‡∏®‡∏©)' : ''}<br>
            <span style="font-size:0.85em; color:#B33939;">${optionText}</span> 
            x${it.qty}
        </div>
        <div style="display:flex; flex-direction:column; align-items:flex-end; gap:4px;">
          <span>${sum} ‡∏ø</span>
          <button class="btn small ghost" style="padding:3px 8px; font-size:0.8em" onclick="removeFromCart(${index})">‡∏•‡∏ö</button>
        </div>
      </div>
      <hr style="border:0; border-top:1px dashed #eee; margin:5px 0;">
    `;
  });

  summary.innerHTML = html;
  totalDisplay.innerText = total.toLocaleString();
}

function removeFromCart(index) {
    cart.splice(index, 1);
    saveAndRender();
}

function clearCart(){
  if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
  cart = [];
  saveAndRender();
}

function goToPayment(){
  // 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÑ‡∏´‡∏°
  if(cart.length === 0){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á");
    return;
  }

  // 2. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Payment
  const note = document.getElementById('noteArea').value;

  const data = {
    shop,
    cart,
    note
  };

  localStorage.setItem('orderDraft', JSON.stringify(data));
  location.href = 'payment.html';
}

</script>
</body>
</html>