<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡πÄ‡∏°‡∏ô‡∏π - FoodOrder</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">FoodOrder</div>
    <div class="top-actions">
      <span id="userLabel" class="user-label hidden"></span>
      <button class="btn small" onclick="location.href='index.html'">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
  </header>

  <main class="container">
    <h2 id="shopTitle">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>

    <div class="menuLayout">
      <div class="menuColumn" id="menuList"></div>

      <aside class="summaryColumn">
        <div class="summaryCard">
          <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
          <div id="orderSummary"><i>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</i></div>

          <label for="noteArea">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
          <textarea id="noteArea" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ú‡∏±‡∏Å / ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß‡∏™‡∏∏‡∏Å"></textarea>

          <div class="tickGroup">
            <p>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö :</p>
            <label class="tick"><input type="checkbox" id="eatHere" onchange="toggleExclusive('eatHere','takeAway')"> ‡∏ó‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô</label>
            <label class="tick"><input type="checkbox" id="takeAway" onchange="toggleExclusive('takeAway','eatHere')"> ‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</label>
          </div>
          
          <div class="summaryFooter">
            <div class="totalLine">‡∏£‡∏ß‡∏°: <span id="totalPrice">0</span> ‡∏ö‡∏≤‡∏ó</div>
            <div style="display:flex;gap:8px;margin-top:6px">
              <button class="btn" onclick="goToPayment()">‡πÑ‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
              <button class="btn ghost" onclick="clearCart()">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </main>

<script>
let user = localStorage.getItem('user');
document.getElementById('userLabel').innerText = user || 'Guest';
if(user) document.getElementById('userLabel').classList.remove('hidden');

const urlParams = new URLSearchParams(window.location.search);
let shop = urlParams.get('shop') || 'somtum';

const shopNamesTH = {
  somtum: "‡∏£‡πâ‡∏≤‡∏ô‡∏™‡πâ‡∏°‡∏ï‡∏≥",
  tamsang: "‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á",
  noodle: "‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß",
  friedchicken: "‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î",
  dessert: "‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô",
};

// üåü ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏õ‡πá‡∏ô Key ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° img ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
const menus = {
  somtum: {
    '‡∏ï‡∏≥‡πÑ‡∏ó‡∏¢': { price: 50, img: 'somtum/‡∏ï‡∏≥‡πÑ‡∏ó‡∏¢.jpg' }, 
    '‡∏ï‡∏≥‡∏õ‡∏π‡∏õ‡∏•‡∏≤‡∏£‡πâ‡∏≤': { price: 60, img: 'somtum/‡∏ï‡∏≥‡∏õ‡∏π‡∏õ‡∏•‡∏≤‡∏£‡πâ‡∏≤.webp' }, 
    '‡∏Ñ‡∏≠‡∏´‡∏°‡∏π‡∏¢‡πà‡∏≤‡∏á': { price: 70, img: 'somtum/‡∏Ñ‡∏≠‡∏´‡∏°‡∏π‡∏¢‡πà‡∏≤‡∏á.jpg' }, 
    '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß': { price: 10, img: 'somtum/‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß.jpg' }
  },
  tamsang: {
    '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö': { price: 55, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏≠‡∏ö.jpg' }, 
    '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö': { price: 50, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö.webp' }, 
    '‡∏ú‡∏±‡∏î‡∏ã‡∏µ‡∏≠‡∏¥‡πä‡∏ß‡∏´‡∏°‡∏π': { price: 55, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡∏ú‡∏±‡∏î‡∏ã‡∏µ‡∏≠‡∏¥‡πä‡∏ß.jpg' }, 
    '‡∏ú‡∏±‡∏î‡∏°‡∏≤‡∏°‡πà‡∏≤': { price: 50, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡∏ú‡∏±‡∏î‡∏°‡∏≤‡∏°‡πà‡∏≤.jpg' }, 
    '‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß': { price: 10, img: '‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á/‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß.webp' }
  },
  noodle: {
    '‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏ô‡πâ‡∏≥‡∏´‡∏°‡∏π‡πÅ‡∏î‡∏á': { price: 50, img: 'noodle/‡∏ô‡πâ‡∏≥‡∏´‡∏°‡∏π‡πÅ‡∏î‡∏á.jpg' }, 
    '‡πÄ‡∏¢‡πá‡∏ô‡∏ï‡∏≤‡πÇ‡∏ü': { price: 60, img: 'noodle/‡πÄ‡∏¢‡πá‡∏ô‡∏ï‡∏≤‡πÇ‡∏ü.jpg' }, 
    '‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏£‡∏∑‡∏≠': { price: 55, img: 'noodle/‡πÄ‡∏ï‡πã‡∏ß‡πÄ‡∏£‡∏∑‡∏≠.jpg' }, 
    '‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤': { price: 60, img: 'noodle/‡πÄ‡∏Å‡∏≤‡πÄ‡∏´‡∏•‡∏≤.jpg' }
  },
  friedchicken: {
    '‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î 2 ‡∏ä‡∏¥‡πâ‡∏ô': { price: 40, img: 'friedchicken/‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà.webp' }, 
    '‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡πá‡∏ï‡πÑ‡∏Å‡πà': { price: 55, img: 'friedchicken/‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡πá‡∏ï.jpg' }, 
    '‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î': { price: 25, img: 'friedchicken/‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà.webp' },
    '‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß': { price: 10, img: 'friedchicken/‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß.jpg' }
  },
  dessert: {
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡∏ô‡∏°‡∏™‡∏î': { price: 70, img: 'dessert/‡∏ô‡∏°‡∏™‡∏î.jpg' }, 
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡πÇ‡∏≠‡∏ß‡∏±‡∏•‡∏ï‡∏¥‡∏ô': { price: 70, img: 'dessert/‡πÇ‡∏≠‡∏ß‡∏±‡∏•‡∏ï‡∏¥‡∏ô.jpg' }, 
    '‡∏ö‡∏¥‡∏á‡∏ã‡∏π ‡∏°‡∏±‡∏à‡∏â‡∏∞': { price: 70, img: 'dessert/‡∏°‡∏±‡∏à‡∏â‡∏∞.jpg' },
  }
};

let cart = JSON.parse(localStorage.getItem('cart') || '[]');
renderMenu();
renderSummary();

function renderMenu(){
  const list = document.getElementById('menuList');
  document.getElementById('shopTitle').innerText = shopNamesTH[shop];
  list.innerHTML = '';

  // ‡πÉ‡∏ä‡πâ Object.entries ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏≠‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π (menuName) ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (item)
  // idx (index ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß) ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á id ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
  Object.entries(menus[shop]).forEach(([menuName, item], idx) => {
    const div = document.createElement('div');
    div.className = 'menuCard';
    div.innerHTML = `
      <div class="imgBox">
        <img src="img/${item.img}" class="menuImg">
      </div>

      <div class="menuInfo">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>${menuName}</strong>
          <span style="color:#666">${item.price} ‡∏ö‡∏≤‡∏ó</span>
        </div>

        <div class="qtyRow">
          <button class="smallBtn" onclick="decQty(${idx})">‚Äì</button>
          <div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <span id="qty-${idx}">0</span></div>
          <button class="smallBtn" onclick="incQty(${idx})">+</button>

          <label class="tick">
            <input type="checkbox" id="special-${idx}"> ‡∏û‡∏¥‡πÄ‡∏®‡∏© (+10 ‡∏ø)
          </label>

          <button class="btn small" onclick="addToCart('${menuName}')">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
      </div>
    `;
    list.appendChild(div);
  });
}

// ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏ä‡πâ idx ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
function incQty(idx){
  const qtyEl = document.getElementById(`qty-${idx}`);
  qtyEl.innerText = parseInt(qtyEl.innerText) + 1;
}

function decQty(idx){
  const qtyEl = document.getElementById(`qty-${idx}`);
  let q = parseInt(qtyEl.innerText);
  if(q > 0) qtyEl.innerText = q - 1;
}

// üåü ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π (menuName) ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Key ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
function addToCart(menuName){
  // ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ index ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á id ‡∏Ç‡∏≠‡∏á qty ‡πÅ‡∏•‡∏∞ special
  let tempIndex = Object.keys(menus[shop]).indexOf(menuName); 

  const qty = parseInt(document.getElementById(`qty-${tempIndex}`).innerText);
  const specialChecked = document.getElementById(`special-${tempIndex}`).checked;

  if(qty <= 0){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô");
    return;
  }

  // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢ menuName ‡πÅ‡∏ó‡∏ô index
  const itemIndex = cart.findIndex(it => it.menuName === menuName && it.shop === shop); 

  if(itemIndex > -1){
    cart[itemIndex].qty += qty;
    cart[itemIndex].special = specialChecked;
  } else {
    // ‡πÄ‡∏Å‡πá‡∏ö menuName ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
    cart.push({menuName: menuName, shop: shop, qty: qty, special: specialChecked}); 
  }

  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  document.getElementById(`qty-${tempIndex}`).innerText = 0; 

  saveAndRender();
}

function saveAndRender(){
  localStorage.setItem('cart', JSON.stringify(cart));
  renderSummary();
}

// üåü ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π (menuName)
function renderSummary(){
  const summary = document.getElementById('orderSummary');
  const totalDisplay = document.getElementById('totalPrice');

  if(cart.length === 0){
    summary.innerHTML = '<i>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</i>';
    totalDisplay.innerText = '0';
    return;
  }

  let total = 0;
  let html = '';

  cart.forEach(it => {
    // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π (it.menuName)
    const item = menus[shop][it.menuName];
    
    // ‡∏´‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ
    if (!item) return; 
    
    const special = it.special ? 10 : 0;
    const sum = (item.price + special) * it.qty;
    total += sum;

    html += `
      <div style="display:flex;justify-content:space-between">
        <div>${it.menuName} x${it.qty} ${it.special ? '(‡∏û‡∏¥‡πÄ‡∏®‡∏©)' : ''}</div>
        <div>${sum} ‡∏ø</div>
      </div>
    `;
  });

  summary.innerHTML = html;
  totalDisplay.innerText = total.toLocaleString();
}

function clearCart(){
  if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
  cart = [];
  saveAndRender();
}

function toggleExclusive(a,b){
  if(document.getElementById(a).checked)
      document.getElementById(b).checked = false;
}

function goToPayment(){
  if(cart.length === 0){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á");
    return;
  }

  const note = document.getElementById('noteArea').value;

  const data = {
    shop,
    cart, // cart ‡∏ó‡∏µ‡πà‡∏°‡∏µ menuName ‡πÅ‡∏ó‡∏ô index
    note,
    eatHere: document.getElementById('eatHere').checked,
    takeAway: document.getElementById('takeAway').checked
  };

  localStorage.setItem('orderDraft', JSON.stringify(data));
  location.href = 'payment.html';
}
</script>
</body>
</html>